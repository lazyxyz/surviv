<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <meta name="title" content="Surviv - Leaderboard." />
  <meta name="description"
    content="The new 2D survival battle royale, inspired by a legendary game loved by millions! Win big with our play-and-earn model and tons of cool items for nonstop fun!" />
  <meta name="keywords" content="battle royale, io game, browser game, open source" />

  <meta property="og:title" content="Surviv Fun - Leaderboard" />
  <meta property="og:description"
    content="The new 2D survival battle royale, inspired by a legendary game loved by millions! Win big with our play-and-earn model and tons of cool items for nonstop fun!" />
  <meta property="og:site_name" content="surviv.fun" />
  <meta property="og:image" content="https://surviv.fun/img/socials/thumbnail.png" />

  <title>Surviv Fun - Leaderboard</title>

  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <link rel="icon" type="image/svg+xml" sizes="any" href="../img/logos/surviv_favicon.svg" />

  <link rel="icon" type="image/x-icon" sizes="16x16" href="../img/logos/surviv_favicon_16x16.png" />
  <link rel="icon" type="image/x-icon" sizes="32x32" href="../img/logos/surviv_favicon_32x32.png" />
  <link rel="icon" type="image/x-icon" sizes="96x96" href="../img/logos/surviv_favicon_96x96.png" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="splash-ui">
    <div style="position: relative;backdrop-filter: blur(40px);">
      <div class="container-table">
        <!-- table header -->
        <div class="header-section">
          <div class="logo">
            <a href="../" title="Play Game (Return Home)">
              <img src="../img/logos/surviv.fun.png" alt="Surviv logo" draggable="false" style="width: 190px;" />
            </a>

            <div>
              <div class="logo-heading">LEADERBOARD</div>

              <div class="logo-body text-xs">Surviv Play-and-Earn on Somnia - Phase I</div>
            </div>
          </div>

          <div class="countdown">
            <div class="pulse-ring" style="display: block"></div>
            <p class="count-time">end in: 00:00 31 Aug 2025 GMT+7</p>
          </div>

          <div class="header">
            <p class="header-title">top survivors</p>
            <div class="header-pagination">
              <button class="btn-pagination" id="prev-page" disabled><i class="fa-solid fa-chevron-left"></i></button>
              <input class="input-pagination" type="text">
              <button class="btn-pagination" id="next-page" disabled><i class="fa-solid fa-chevron-right"></i></button>
            </div>
          </div>
        </div>

        <!--table body -->
        <div class="body-section">
          <div class="leaderboard">
            <div class="leaderboard-header">
              <div class="w-[80px] h-[48px]" id="header-child">Rank</div>
              <div class="w-[350px] h-[48px]" id="header-child">Player</div>
              <div class="w-[160px] h-[48px]" id="header-child">Total Points</div>
              <div class="w-[160px] h-[48px] relative" id="header-child">
                Solo Points
                <i class="fa-solid fa-circle-question text-sm ml-1 cursor-pointer hover:text-yellow-400 transition-colors"
                  id="solo-tooltip-toggle"></i>
                <div id="solo-tooltip"
                  class="hidden absolute z-10 bg-gray-800 text-white text-sm p-4 rounded-lg shadow-lg w-64 left-0 top-12">
                  <ul class="list-disc pl-5">
                    <li>Rank #1: 10 points</li>
                    <li>Rank #2: 5 points</li>
                    <li>Rank #3: 3 points</li>
                    <li>Rank #4: 2 points</li>
                    <li>Rank #5: 1 point</li>
                  </ul>
                </div>
              </div>
              <div class="w-[160px] h-[48px] relative" id="header-child">
                Squad Points
                <i class="fa-solid fa-circle-question text-sm ml-1 cursor-pointer hover:text-yellow-400 transition-colors"
                  id="squad-tooltip-toggle"></i>
                <div id="squad-tooltip"
                  class="hidden absolute z-10 bg-gray-800 text-white text-sm p-4 rounded-lg shadow-lg w-64 left-0 top-12">
                  <ul class="list-disc pl-5">
                    <li>Rank #1: 6 points </li>
                    <li>Rank #2: 3 points</li>
                    <li>Rank #3: 1 point</li>
                  </ul>
                </div>
              </div>
              <div class="w-[160px] h-[48px] relative" id="header-child">
                Social Points
                <i class="fa-solid fa-circle-question text-sm ml-1 cursor-pointer hover:text-yellow-400 transition-colors"
                  id="social-tooltip-toggle"></i>
                <div id="social-tooltip"
                  class="hidden absolute z-10 bg-gray-800 text-white text-sm p-4 rounded-lg shadow-lg w-64 left-0 top-12">
                  <ul class="list-disc pl-5">
                    <li>Earned by completing tasks on Galxe.</li>
                  </ul>
                </div>
              </div>
              <div class="w-[110px] h-[48px]" id="header-child">Games</div>
              <div class="w-[100px] h-[48px]" id="header-child">Rate</div>
            </div>
            <div class="my-ranking-data"></div>
            <div class="leaderboard-body" id="table-body">
            </div>
          </div>
        </div>
        <div id="loading" class="text-center text-[#ffd23a] font-semibold mt-6 hidden">Loading...</div>
        <div id="error" class="text-center text-red-400 font-semibold mt-6 hidden"></div>
      </div>
    </div>
  </div>
  <script>
    const API_URL = 'https://api.surviv.fun/api/playerRankings';
    let currentPage = 1;
    const limit = 100;
    let totalPages = 1;

    // Shorten Wallet Address
    function shortenAddress(address, chars = 10) {
      if (!address) return '';
      return `${address.slice(0, 2 + chars)}...${address.slice(-chars)}`;
    }

    const pageInput = document.querySelector('.input-pagination');
    const prevButton = document.getElementById('prev-page');
    const nextButton = document.getElementById('next-page');

    // Tooltip toggle functionality
    function toggleTooltip(tooltipId) {
      const tooltips = ['solo-tooltip', 'squad-tooltip', 'social-tooltip'];
      tooltips.forEach(id => {
        const tooltip = document.getElementById(id);
        if (tooltip) {
          tooltip.classList.add('hidden');
        }
      });

      const tooltip = document.getElementById(tooltipId);
      tooltip.classList.toggle('hidden');
    }

    // Initialize tooltip listeners
    document.getElementById('solo-tooltip-toggle').addEventListener('click', () => toggleTooltip('solo-tooltip'));
    document.getElementById('squad-tooltip-toggle').addEventListener('click', () => toggleTooltip('squad-tooltip'));
    document.getElementById('social-tooltip-toggle').addEventListener('click', () => toggleTooltip('social-tooltip'));

    // Close all tooltips when clicking outside
    document.addEventListener('click', (e) => {
      const tooltips = ['solo-tooltip', 'squad-tooltip', 'social-tooltip'];
      const toggleIds = ['solo-tooltip-toggle', 'squad-tooltip-toggle', 'social-tooltip-toggle'];
      if (!toggleIds.includes(e.target.id) && !e.target.closest('.fa-circle-question')) {
        tooltips.forEach(id => {
          const tooltip = document.getElementById(id);
          if (tooltip && !tooltip.classList.contains('hidden')) {
            tooltip.classList.add('hidden');
          }
        });
      }
    });

    function updatePaginationUI() {
      pageInput.value = `${currentPage}/${totalPages}`;
      prevButton.disabled = currentPage <= 1;
      nextButton.disabled = currentPage >= totalPages;
    }

    async function fetchLeaderboard(page) {
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const leaderboardBody = document.getElementById('table-body');

      loading.classList.remove('hidden');
      error.classList.add('hidden');
      leaderboardBody.innerHTML = '';

      try {
        const response = await fetch(`${API_URL}?page=${page}&limit=${limit}`);
        const data = await response.json();

        if (!data.success) {
          throw new Error('Failed to fetch leaderboard data');
        }

        totalPages = data.totalPages || 1;
        updatePaginationUI();

        data.players.forEach((player, index) => {
          const row = document.createElement('div');
          row.className = 'leaderboard-body-row';
          row.innerHTML = `
            <div class="w-[80px] h-[48px]" id="row-child">${(page - 1) * limit + index + 1}</div>
            <div class="w-[350px] h-[48px]" id="row-child">${shortenAddress(player.player)}<i id="copy-address-${index}" class="fa-solid fa-copy ml-2 cursor-pointer hover:text-green-400 transition-colors" title="Copy full address"></i></div>
            <div class="w-[160px] h-[48px]" id="row-child">${player.totalPoints}</div>
            <div class="w-[160px] h-[48px]" id="row-child">${player.soloPoints}</div>
            <div class="w-[160px] h-[48px]" id="row-child">${player.squadPoints}</div>
            <div class="w-[160px] h-[48px]" id="row-child">${player.socialPoints}</div>
            <div class="w-[110px] h-[48px]" id="row-child">${player.games}</div>
            <div class="w-[100px] h-[48px]" id="row-child">${player.games > 0 ? ((player.soloPoints + player.squadPoints) / player.games).toFixed(2) : '0.00'}</div>
          `;
          leaderboardBody.appendChild(row);

          // Add copy functionality for this specific row
          const copyIcon = document.getElementById(`copy-address-${index}`);
          copyIcon.addEventListener('click', async () => {
            try {
              await navigator.clipboard.writeText(player.player);

              // Visual feedback
              copyIcon.classList.remove('fa-copy');
              copyIcon.classList.add('fa-circle-check', 'text-green-400');
              copyIcon.title = 'Copied!';

              // Reset icon after 1.5 seconds
              setTimeout(() => {
                copyIcon.classList.remove('fa-circle-check', 'text-green-400');
                copyIcon.classList.add('fa-copy');
                copyIcon.title = 'Copy full address';
              }, 1500);

            } catch (err) {
              // Fallback for older browsers
              const textArea = document.createElement('textarea');
              textArea.value = player.player;
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);

              // Visual feedback for fallback
              copyIcon.classList.add('text-blue-400');
              setTimeout(() => copyIcon.classList.remove('text-blue-400'), 500);
            }
          });
        });

      } catch (err) {
        error.textContent = 'Error loading leaderboard. Please try again later.';
        error.classList.remove('hidden');
      } finally {
        loading.classList.add('hidden');
      }
    }

    prevButton.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        fetchLeaderboard(currentPage);
      }
    });

    nextButton.addEventListener('click', () => {
      if (currentPage < totalPages) {
        currentPage++;
        fetchLeaderboard(currentPage);
      }
    });

    // Input page navigation
    pageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        let val = parseInt(pageInput.value.split('/')[0]);
        if (!isNaN(val) && val >= 1 && val <= totalPages) {
          currentPage = val;
          fetchLeaderboard(currentPage);
        } else {
          pageInput.value = `${currentPage}/${totalPages}`; // Reset to valid value
        }
      }
    });

    // Fetch initial leaderboard
    fetchLeaderboard(currentPage);
  </script>
  <script src="../src/earn.ts" type="module"></script>
</body>

</html>